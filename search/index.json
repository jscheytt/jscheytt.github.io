[{"content":"I really love Docker, and I also come to like security more and more. One advice I have been hearing a lot (e.g. in this Container Security Cheat Sheet from Snyk) is that you should not run your container as a root user.\n\u0026ldquo;Easy thing,\u0026rdquo; I thought to myself, \u0026ldquo;I am just going to put something like USER {app}\u0026rdquo; at the top of my Dockerfile.\u0026quot; Well, think again, because:\nFROMnode:ltsUSERnode# I would have thought that after this point, every action will happen in the name of this user# and also that every created directory and file will belong to this user ... üòï But:# ‚ö†Ô∏è This directory is created by root:root!WORKDIR/app# ‚ö†Ô∏è These files will be copied over to be owned by root:root!COPY package*.json ./# üí• This step fails in some (not all!) environments with errors like \u0026#34;Not enough permissions on /app\u0026#34;RUN npm install \u0026amp;\u0026amp; \\  npm run verify# ‚ö†Ô∏è If you manage to get to this point, these files, too, will be copied over to be owned by root:root!COPY . .ENTRYPOINT [\u0026#34;npm\u0026#34;]I ended up fixing it by creating the directory and then chown-ing it. Equally I executed the COPY instructions with the --chown flag. In the end I refactored it a bit using some ENVs, too:\nFROMnode:lts# Ensure that target WORKDIR exists and is owned by target (non-root) userENV USERNAME=node ENV USERID=$USERNAME:$USERNAMEENV TARGETDIR=/appRUN mkdir -p $TARGETDIR \u0026amp;\u0026amp; chown -R $USERID $TARGETDIRWORKDIR$TARGETDIRUSER$USERNAMECOPY --chown=$USERID package*.json ./RUN npm install \u0026amp;\u0026amp; \\  npm run verifyCOPY --chown=$USERID . .ENTRYPOINT [\u0026#34;npm\u0026#34;]","date":"2021-07-23T14:42:07+02:00","permalink":"https://jscheytt.github.io/p/til-docker-does-not-really-help-you-a-lot-trying-to-get-permissions-right/","title":"TIL Docker does not really help you a lot trying to get permissions right"},{"content":"I have developed quite some muscle memory in terminating vim via :wqa. Now I can save one more character by retraining myself to use :xa! üòÑ\nI also like how :x sort of symbolizes the close button ‚ùå of many window managers and their default behavior of saving when you close a file.\nFor more documentation open vim and type :h :x.\nWait, now that you mention it \u0026hellip; Well, turns out the documentation mentions an even easier way: Just press ZZ (without the colon) üò¥\nNow if only I could combine this to perform :wqa \u0026hellip;\nHappy vim-ing! üëã\n","date":"2021-07-16T00:00:00Z","permalink":"https://jscheytt.github.io/p/til-you-can-wq-in-vim-with-x/","title":"TIL you can :wq in vim with :x"}]